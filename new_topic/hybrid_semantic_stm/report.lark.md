## BERTopic 语义初始化与计量因果分析报告

本报告旨在探索将 BERTopic 嵌入式主题模型作为语义初始化，结合协变量驱动的回归分析与朴素计量因果方法（PSM），对酒店评论数据进行深入分析。此混合管线旨在融合深度学习的语义表征能力与传统计量经济学的严谨推断框架，并与原有的结构化主题模型（STS）结果进行对比。

### 1. 数据整合与特征工程

我们首先整合了 `Hotel_Reviews_1k_sample.csv` 原始评论数据与 `bertopic_doc_topics.csv` 中由 BERTopic 生成的文档-主题分配。在整合过程中，我们丢弃了 BERTopic 识别出的噪声主题（`topic=-1`）。

随后，我们进行了特征工程，从 `Tags` 字段中通过正则表达式提取了关键协变量，包括：
- **旅行类型**: `is_leisure`, `is_business` (二值)
- **同行者**: `is_couple`, `is_solo` (二值)
- **住宿时长**: `stayed_nights` (数值)

这些派生特征与评论原有的 `Reviewer_Score`, `month_idx`, `days_num`, `Total_Number_of_Reviews_Reviewer_Has_Given` 一同构成了我们的协变量矩阵。

对于主题特征，我们为每个文档保留了其被分配到的 BERTopic 主题及其对应的概率 `topic_prob`，并将其转换为宽格式，每个主题的概率作为一列。

### 2. 协变量驱动的“主题暴露”回归

为了模拟 STM 的主题暴露（Prevalence）分析，我们对每个 BERTopic 主题 k 进行了回归。因变量 y 为文档对该主题的概率 `topic_prob`，经过 logit 变换 `logit((y*(n-1)+0.5)/n)` 以处理边界值问题。自变量 X 为我们构造的协变量矩阵。

我们使用 OLS 模型并配合异方差稳健标准误（White's SE）进行估计。核心发现如下表所示（仅展示部分显著变量）：

| 主题 ID (BERTopic) | 显著协变量 | 系数 (coef) | P-value | 主题 R² |
| :--- | :--- | :--- | :--- | :--- |
| 0 | reviewer_score | 0.928 | < 0.001 | 0.045 |
| 2 | stayed_nights | -0.481 | < 0.001 | 0.032 |
| 3 | reviewer_score | -0.659 | < 0.001 | 0.068 |
| 6 | reviewer_score | -0.340 | 0.001 | 0.029 |
| 9 | is_leisure | 0.798 | 0.001 | 0.010 |
| 11 | is_leisure | 0.616 | 0.003 | 0.010 |
| 12 | is_business | 1.159 | 0.018 | 0.013 |

**解读**:
- **评分 (`reviewer_score`)** 对多个主题的讨论概率有显著影响。例如，高分评论更倾向于讨论主题 0，而低分评论更倾向于讨论主题 3 和 6。
- **住宿时长 (`stayed_nights`)** 与主题 2 的讨论概率呈显著负相关。
- **旅行类型** 也起到了作用，例如休闲旅行者 (`is_leisure`) 更关注主题 9 和 11，而商务旅行者 (`is_business`) 更关注主题 12。

### 3. 协变量驱动的“评分/情感”回归

为近似 STS 的情感分析侧，我们以 `Reviewer_Score` 作为因变量，将 BERTopic 的主题概率全量向量及其他协变量作为自变量进行 OLS 回归（使用稳健标准误）。

**重要声明**：此处的 `Reviewer_Score` 是对整体评论的情感代理，与 STS 模型中估计的、针对每个主题的潜在情感变量 α(s) 在概念上存在差异。本分析旨在探索主题讨论概率与总体评分之间的关联性。

部分显著主题的系数如下：

| 主题概率 (topic_prob_*) | 对评分的系数 (coef) | P-value |
| :--- | :--- | :--- |
| topic_prob_0 | 1.063 | < 0.001 |
| topic_prob_3 | -1.929 | 0.002 |
| topic_prob_4 | 1.360 | < 0.001 |
| topic_prob_6 | -1.255 | 0.006 |
| topic_prob_9 | 1.094 | < 0.001 |
| topic_prob_11 | 1.177 | < 0.001 |

**解读**:
- 讨论某些主题的概率与最终评分显著相关。例如，当评论中 **主题 0, 4, 9, 11** 的讨论概率增加时，评论的总体评分也倾向于更高。
- 相反，当 **主题 3 和 6** 的讨论概率增加时，评论的总体评分有降低的趋势。这表明这些主题可能承载了更多的负面或抱怨内容。

### 4. 朴素计量因果分析：PSM 示例

我们以“商务旅行 vs. 休闲旅行”为例，进行了一次探索性的倾向得分匹配（PSM）分析，以估计商务旅行对 `Reviewer_Score` 的平均处理效应（ATT）。

- **处理组**: `is_business = 1`
- **控制组**: `is_leisure = 1`
- **协变量**: BERTopic 主题概率向量、`month_idx`、`days_num`、`reviewer_reviews`、`stayed_nights`

我们采用 1:1 最近邻匹配（卡尺设为 0.1）。

**PSM 结果**:
- **ATT (平均处理效应)**: **-0.325**
- **95% 置信区间**: [-0.736, 0.086]
- **匹配后样本**: 119 对

**结论**: ATT 的点估计为负，表明在控制了可观测的协变量（尤其是评论中讨论的主题）后，商务旅行者的评分平均比休闲旅行者低 0.325 分。但由于置信区间包含 0，**该效应在统计上不显著**。

**平衡性检验**:
匹配后，大部分协变量的标准化均值差异（Standardized Mean Difference）都显著减小，多数降至 0.1 以下，表明匹配效果良好，处理组与控制组在协变量分布上变得更为相似。

| 协变量 | 匹配前差异 | 匹配后差异 |
| :--- | :--- | :--- |
| topic_prob_8 | 0.297 | 0.086 |
| reviewer_reviews | 0.210 | -0.034 |
| topic_prob_0 | -0.179 | 0.101 |


**谨慎性声明**: 本 PSM 分析仅为方法学示例，其结论的因果解释力受限于“可忽略性”这一强假设（即所有影响处理分配和结果的变量均被观测到），现实中可能存在未观测到的混杂因素。

### 5. 与原 STS 结果对比

我们读取了原 STS 模型估计的系数，并与本次混合管线的结果进行了方向性对比。由于模型设定和主题定义的差异，直接比较系数大小意义有限，我们更关注符号（正/负）的一致性。

- **主题暴露 (Prevalence)**: 在 `reviewer_score` 对主题概率的影响上，我们的 OLS 回归结果与原 STS prevalence 回归结果在**符号方向上存在较多不一致**。这可能源于 BERTopic 和 STS 对“主题”的定义和划分方式根本不同。
- **情感/评分 (Sentiment)**: 此项对比更为间接。STS 估计的是评分对“主题情感”的影响，而我们估计的是“主题概率”对评分的影响。尽管如此，我们观察到一些有趣的对应关系，但符号方向同样存在不一致。

**总结**: 混合管线与 STS 在协变量对主题的影响上得出了不同的结论。这凸显了不同主题建模范式（生成式 vs. 描述式/聚类）如何影响下游的计量分析。BERTopic 基于语义相似度聚类，而 STS 则是在一个统一的概率图模型中联合估计主题与协变量关系，两者机理不同，结果存在差异是符合预期的。

### 6. 结论与方法论思考

本次实验成功构建并执行了一个“BERTopic + 协变量回归 + PSM”的混合分析管线。

- **优势**:
  - **语义丰富性**: BERTopic 利用了预训练语言模型的强大语义表征能力，其生成的主题可能更具内在连贯性和可解释性。
  - **灵活性**: 将主题建模与下游计量分析解耦，使得研究者可以灵活替换任一环节的模型（例如，使用不同的嵌入模型或匹配算法）。

- **限制与挑战**:
  - **两阶段问题**: 这种“先提主题，后做回归”的两阶段方法，其标准误通常是有偏的，因为忽略了第一阶段主题模型估计的不确定性。相比之下，STS 在一个统一框架内估计所有参数，理论上更严谨。
  - **因果解释的审慎**: 如 PSM 部分所述，任何基于观测数据的因果声明都需要极强的假设。将 NLP 特征纳入因果框架时，必须对这些特征的“外生性”和“可忽略性”保持高度警惕。

总的来说，将嵌入式主题作为“语义特征”输入到计量模型中是一条富有前景的路径，它为理解文本数据背后的社会经济现象提供了新的视角。然而，研究者必须清醒地认识到其方法论上的局限性，并在报告结论时保持必要的审慎。
